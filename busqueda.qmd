# B칰squeda y Filtrado

La capacidad de encontrar informaci칩n r치pidamente en archivos y datos es crucial para la productividad. Esta secci칩n cubre las herramientas m치s potentes para b칰squeda de texto, filtrado interactivo y procesamiento de datos estructurados.

## ripgrep (rg) - B칰squeda ultrarr치pida {#sec-ripgrep}

`ripgrep` es una herramienta de b칰squeda que combina la potencia de `grep` con la velocidad moderna y caracter칤sticas inteligentes como respeto autom치tico de `.gitignore`.

### Caracter칤sticas principales

- 游 **Extremadamente r치pido** - Hasta 10x m치s r치pido que grep
- 游꿢 **Respeta .gitignore** autom치ticamente
- 游깯 **Colores por defecto** para mejor legibilidad
- 游댌 **B칰squeda recursiva** por defecto
- 游늬 **Filtros por tipo de archivo** inteligentes

### Uso b치sico

```bash
# B칰squeda simple en directorio actual
rg "funci칩n"

# B칰squeda ignorando may칰sculas/min칰sculas
rg -i "error"

# Buscar palabra completa
rg -w "class"

# B칰squeda literal (sin regex)
rg -F "console.log("
```

### Ejemplos por tipo de archivo

#### Desarrollo web

```bash
# Buscar imports en archivos JavaScript
rg -t js "import.*from"

# Encontrar funciones en TypeScript
rg -t ts "function\s+\w+" 

# Buscar clases CSS
rg -t css "\.[\w-]+\s*\{"

# APIs en archivos de configuraci칩n
rg -t json "api.*url"
```

#### Python

```bash
# Buscar definiciones de clase
rg -t py "^class\s+\w+"

# Encontrar imports espec칤ficos
rg -t py "from django import"

# Buscar decoradores
rg -t py "@\w+"

# Variables de entorno
rg -t py "os\.environ"
```

### Filtros avanzados

#### Por ubicaci칩n

```bash
# Buscar solo en archivos de configuraci칩n
rg "database" --glob="*.{conf,cfg,ini,yaml,yml}"

# Excluir directorios espec칤ficos
rg "TODO" --glob="!node_modules/**"

# Buscar en archivos modificados recientemente
find . -mtime -1 -name "*.py" | xargs rg "import"
```

#### Por contexto

```bash
# Mostrar 3 l칤neas antes y despu칠s
rg -A 3 -B 3 "error"

# Mostrar 5 l칤neas de contexto
rg -C 5 "function main"

# Mostrar n칰mero de l칤nea
rg -n "import React"

# Mostrar solo nombres de archivos que contienen el patr칩n
rg -l "password"
```

### Casos de uso avanzados

#### Auditor칤a de c칩digo

```bash
# Encontrar hardcoded passwords/secrets
rg -i "(password|secret|key|token)\s*[:=]" --type-not=json

# Buscar c칩digo duplicado (funciones similares)
rg "function \w+\(" -A 10 | grep -A 10 "function.*(" | sort | uniq -d

# Encontrar imports no utilizados en Python
rg "^import \w+" -t py | cut -d: -f2 | sort | uniq > imports.txt
# Luego verificar cada import en el c칩digo

# URLs hardcodeadas
rg "https?://[^\s\"']+"
```

#### An치lisis de logs

```bash
# Errores por severidad
rg "(ERROR|WARN|INFO)" /var/log/app.log

# IPs sospechosas (muchas peticiones)
rg -o "\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b" access.log | \
sort | uniq -c | sort -nr | head -10

# C칩digos de error HTTP
rg " [45]\d{2} " access.log -o | sort | uniq -c
```

#### Migraci칩n de c칩digo

```bash
# Encontrar uso de API deprecated
rg "\.oldFunction\(" -t js

# Buscar patterns espec칤ficos para refactoring
rg "var\s+\w+\s*=" -t js  # Variables con 'var' para cambiar a 'let/const'

# Encontrar comentarios TODO/FIXME con contexto
rg -C 2 "(TODO|FIXME|HACK)"
```

### Configuraci칩n personalizada

#### Archivo de configuraci칩n

Crear `~/.ripgreprc`:

```bash
# Siempre mostrar n칰meros de l칤nea
--line-number

# B칰squeda inteligente de may칰sculas
--smart-case

# Mostrar tipos de archivo soportados
--type-list

# Colores personalizados
--colors=line:fg:yellow
--colors=line:style:bold
--colors=path:fg:green
--colors=match:fg:red
--colors=match:style:bold
```

---

## fzf - Filtro difuso interactivo {#sec-fzf}

`fzf` es un filtro de l칤nea de comandos que permite b칰squeda difusa interactiva en cualquier lista de elementos.

### Configuraci칩n inicial

```bash
# Configurar para zsh (agregar a .zshrc)
source <(fzf --zsh)

# Variables de entorno 칰tiles
export FZF_DEFAULT_COMMAND='rg --files --hidden --follow --glob "!.git/*"'
export FZF_DEFAULT_OPTS='--height 40% --layout=reverse --border'
```

### Uso b치sico interactivo

```bash
# Buscar archivos en directorio actual
find . -type f | fzf

# Buscar en historial de comandos
history | fzf

# Buscar procesos
ps aux | fzf
```

### Ejemplos pr치cticos

#### Navegaci칩n de archivos

```bash
# Editar archivo seleccionado
vim $(find . -type f | fzf)

# Abrir en VS Code
code $(find . -name "*.py" | fzf)

# Ver contenido de archivo seleccionado
cat $(find . -name "*.md" | fzf)

# Ir a directorio seleccionado
cd $(find . -type d | fzf)
```

#### Git workflow

```bash
# Checkout a branch
git checkout $(git branch | fzf | tr -d ' ')

# Ver commit espec칤fico
git show $(git log --oneline | fzf | cut -d' ' -f1)

# Agregar archivos selectivamente
git add $(git status --porcelain | fzf -m | cut -c4-)

# Ver diff de archivo
git diff $(git status --porcelain | fzf | cut -c4-)
```

#### Gesti칩n de procesos

```bash
# Matar proceso seleccionado
kill $(ps aux | fzf | awk '{print $2}')

# Ver logs de servicio systemd
journalctl -u $(systemctl list-units --type=service | fzf | awk '{print $1}')

# Conectar por SSH
ssh $(grep "^Host " ~/.ssh/config | cut -d' ' -f2 | fzf)
```

### Integraci칩n avanzada

#### Funciones de shell personalizadas

```bash
# Funci칩n para buscar y editar archivos
fe() {
    local files
    files=$(find . -type f | fzf --multi --preview 'bat --color=always {}')
    [[ -n "$files" ]] && ${EDITOR:-vim} "${files[@]}"
}

# Funci칩n para navegar a directorio frecuente
fd() {
    local dir
    dir=$(find ${1:-.} -type d 2>/dev/null | fzf +m) && cd "$dir"
}

# Funci칩n para ver historia de comandos y ejecutar
fh() {
    eval $( ([ -n "$ZSH_NAME" ] && fc -l 1 || history) | fzf +s --tac | sed 's/ *[0-9]* *//')
}

# Funci칩n para matar procesos interactivamente
fkill() {
    local pid
    pid=$(ps -ef | sed 1d | fzf -m | awk '{print $2}')
    if [ "x$pid" != "x" ]; then
        echo $pid | xargs kill -${1:-9}
    fi
}
```

#### Vista previa avanzada

```bash
# Buscar archivos con vista previa
fzf --preview 'bat --style=numbers --color=always --line-range :500 {}'

# Buscar en git commits con vista previa
git log --oneline | fzf --preview 'git show --color=always {1}'

# Buscar archivos de c칩digo con vista previa y n칰meros de l칤nea
rg --files | fzf --preview 'bat --style=numbers --color=always --highlight-line {2} {1}' --delimiter ':'
```

---

## jq - Procesador JSON {#sec-jq}

`jq` es como `sed` pero para datos JSON, permitiendo consultar, filtrar y transformar datos JSON de manera elegante.

### Sintaxis b치sica

```bash
# Pretty print JSON
curl -s https://api.github.com/users/octocat | jq .

# Extraer campo espec칤fico
echo '{"name":"Juan","age":30}' | jq .name

# Extraer campo anidado
echo '{"user":{"name":"Juan"}}' | jq .user.name
```

### Filtros b치sicos

#### Acceso a datos

```bash
# Array de objetos - extraer campo de todos
jq '.[].name' users.json

# Filtrar por condici칩n
jq '.[] | select(.age > 25)' users.json

# Extraer m칰ltiples campos
jq '.[] | {name: .name, email: .email}' users.json

# Contar elementos
jq '. | length' array.json
```

#### Transformaciones

```bash
# Crear nuevo objeto
jq '{full_name: (.first_name + " " + .last_name), age: .age}' person.json

# Agregar campo
jq '. + {timestamp: now}' data.json

# Eliminar campo
jq 'del(.password)' user.json

# Renombrar campo
jq '{username: .name, years: .age}' user.json
```

### Casos de uso con APIs

#### GitHub API

```bash
# Listar repositorios p칰blicos de un usuario
curl -s https://api.github.com/users/octocat/repos | \
jq '.[] | {name: .name, stars: .stargazers_count, language: .language}'

# Top 5 repos por estrellas
curl -s https://api.github.com/users/octocat/repos | \
jq 'sort_by(.stargazers_count) | reverse | .[0:5] | .[] | .name'

# Repos por lenguaje
curl -s https://api.github.com/users/octocat/repos | \
jq 'group_by(.language) | .[] | {language: .[0].language, count: length}'
```

#### An치lisis de logs JSON

```bash
# Logs de aplicaci칩n en formato JSON
cat app.log | jq 'select(.level == "ERROR")' 

# Agrupar errores por tipo
cat app.log | jq 'select(.level == "ERROR") | .error_type' | sort | uniq -c

# Estad칤sticas por hora
cat app.log | jq -r '.timestamp[0:13]' | sort | uniq -c
```

### Operaciones avanzadas

#### Agregaciones y estad칤sticas

```bash
# Promedio de edades
jq '[.[] | .age] | add / length' users.json

# Valor m치ximo
jq '[.[] | .score] | max' scores.json

# Agrupar y contar
jq 'group_by(.category) | .[] | {category: .[0].category, count: length}' items.json

# Crear histograma de frecuencias
jq '[.[] | .status] | group_by(.) | .[] | {status: .[0], count: length}' requests.json
```

#### Transformaciones complejas

```bash
# Convertir array de objetos a objeto indexado
jq 'map({(.id|tostring): .}) | add' items.json

# Pivot de datos
jq 'group_by(.category) | map({category: .[0].category, items: map(.name)})' products.json

# Merge de m칰ltiples objetos
jq '. as $root | .users[] | . + {company: $root.company}' company.json
```

#### Validaci칩n y filtrado

```bash
# Verificar estructura requerida
jq 'if has("name") and has("email") then . else empty end' user.json

# Filtros complejos con m칰ltiples condiciones
jq '.[] | select(.age > 18 and .status == "active" and (.roles | contains(["admin"])))' users.json

# Validar emails
jq '.[] | select(.email | test("^[^@]+@[^@]+\\.[^@]+$"))' contacts.json
```

### Integraci칩n con otras herramientas

#### Con curl para APIs

```bash
# Script para monitorear API
#!/bin/bash
API_URL="https://api.example.com/status"
while true; do
    status=$(curl -s "$API_URL" | jq -r '.status')
    if [ "$status" != "ok" ]; then
        echo "ALERT: API status is $status"
        # Enviar notificaci칩n
    fi
    sleep 60
done
```

#### Con fzf para selecci칩n interactiva

```bash
# Seleccionar usuario de API y ver detalles
user_id=$(curl -s https://api.example.com/users | \
          jq -r '.[] | "\(.id): \(.name)"' | \
          fzf | cut -d: -f1)

curl -s "https://api.example.com/users/$user_id" | jq .
```

#### Conversion de formatos

```bash
# JSON a CSV
jq -r '.[] | [.name, .age, .email] | @csv' users.json

# JSON a tabla HTML
jq -r '.[] | "<tr><td>\(.name)</td><td>\(.age)</td></tr>"' users.json

# JSON a variables de entorno
jq -r 'to_entries[] | "export \(.key)=\(.value)"' config.json
```

---

## Workflows complejos combinando herramientas

### An치lisis completo de c칩digo base

```bash
#!/bin/bash
# Script para analizar un proyecto completo

echo "=== AN츼LISIS DEL PROYECTO ==="

# 1. Estad칤sticas generales
echo "Archivos por tipo:"
find . -type f | grep -E '\.[a-z]+$' | sed 's/.*\.//' | sort | uniq -c | sort -nr

# 2. Funciones m치s utilizadas
echo -e "\nFunciones m치s referenciadas:"
rg -o '\w+\(' --type js | sed 's/(//' | sort | uniq -c | sort -nr | head -10

# 3. TODOs y FIXMEs
echo -e "\nTareas pendientes:"
rg -C 1 "(TODO|FIXME|HACK)" | head -20

# 4. Archivos grandes
echo -e "\nArchivos m치s grandes:"
find . -type f -exec du -h {} + | sort -rh | head -10

# 5. Dependencias externas (JS/Python)
echo -e "\nImports externos m치s comunes:"
rg "^(import|from).*['\"]([^./].*)['\"]" -o --type py --type js | \
cut -d'"' -f2 | cut -d"'" -f2 | sort | uniq -c | sort -nr | head -10
```

### Pipeline de procesamiento de datos

```bash
#!/bin/bash
# Procesar logs de servidor web y generar reporte

LOG_FILE="/var/log/nginx/access.log"

echo "=== REPORTE DE ACCESO WEB ==="

# 1. Top 10 IPs
echo "Top 10 IPs por n칰mero de requests:"
rg -o '^\S+' "$LOG_FILE" | sort | uniq -c | sort -nr | head -10

# 2. P치ginas m치s visitadas
echo -e "\nP치ginas m치s visitadas:"
rg -o '"GET ([^"]*)"' "$LOG_FILE" | cut -d' ' -f2 | sort | uniq -c | sort -nr | head -10

# 3. C칩digos de error
echo -e "\nC칩digos de respuesta:"
rg -o '" \d{3} ' "$LOG_FILE" | tr -d ' "' | sort | uniq -c | sort -nr

# 4. User agents m치s comunes
echo -e "\nNavigadores/bots m치s comunes:"
rg -o '"[^"]*" "[^"]*" "([^"]*)"$' "$LOG_FILE" | \
cut -d'"' -f6 | sort | uniq -c | sort -nr | head -10

# 5. Generar JSON para dashboard
echo -e "\nGenerando reporte JSON..."
{
    echo '{'
    echo '  "timestamp": "'$(date -Iseconds)'",'
    echo '  "total_requests": '$(wc -l < "$LOG_FILE")','
    echo '  "unique_ips": '$(rg -o '^\S+' "$LOG_FILE" | sort -u | wc -l)','
    echo '  "top_pages": ['
    rg -o '"GET ([^"]*)"' "$LOG_FILE" | cut -d' ' -f2 | sort | uniq -c | sort -nr | head -5 | \
    jq -R '. | split(" ") | {count: .[0]|tonumber, page: .[1]}' | jq -s .
    echo '  ]'
    echo '}'
} > web_report.json

echo "Reporte guardado en web_report.json"
```

### B칰squeda interactiva universal

```bash
#!/bin/bash
# Funci칩n para b칰squeda universal con vista previa

universal_search() {
    local search_term="$1"
    
    if [ -z "$search_term" ]; then
        echo "Uso: universal_search <t칠rmino>"
        return 1
    fi
    
    # Buscar en archivos de c칩digo
    echo "=== Archivos de c칩digo ==="
    rg -l "$search_term" --type-add 'code:*.{py,js,ts,go,rs,java,cpp,c,h}' -t code | \
    fzf --preview "rg --color=always '$search_term' {}" \
        --preview-window=right:60% \
        --header="Archivos de c칩digo que contienen '$search_term'"
    
    # Buscar en documentaci칩n
    echo -e "\n=== Documentaci칩n ==="
    rg -l "$search_term" --type-add 'docs:*.{md,txt,rst,org}' -t docs | \
    fzf --preview "bat --color=always {}" \
        --preview-window=right:60% \
        --header="Documentaci칩n que contiene '$search_term'"
    
    # Buscar en configuraci칩n
    echo -e "\n=== Archivos de configuraci칩n ==="
    rg -l "$search_term" --type-add 'config:*.{yaml,yml,json,toml,ini,conf}' -t config | \
    fzf --preview "bat --color=always {}" \
        --preview-window=right:60% \
        --header="Configuraci칩n que contiene '$search_term'"
}

# Uso: universal_search "database"
```

::: {.callout-tip}
## Tips para b칰squeda eficiente
- Combina `rg` con `fzf` para b칰squeda interactiva con vista previa
- Usa `jq` con `-r` para output raw (sin comillas) cuando necesites procesar m치s
- Configura aliases para combinaciones que uses frecuentemente
- `ripgrep` respeta `.gitignore` autom치ticamente, 칰salo en proyectos de c칩digo
:::

::: {.callout-important}
## Rendimiento
- `ripgrep` es extremadamente r치pido, pero en directorios muy grandes considera usar `--max-depth`
- `jq` puede consumir mucha memoria con archivos JSON grandes, usa streaming con `--stream` si es necesario
- `fzf` es r치pido, pero la vista previa puede ser lenta con archivos grandes
:::

En el pr칩ximo cap칤tulo exploraremos herramientas esenciales para desarrollo y control de versiones con Git.
